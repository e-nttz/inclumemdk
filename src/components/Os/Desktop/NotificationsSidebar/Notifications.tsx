import Button from "@/components/Ui/Buttons/button";
import { useNotification } from "@/providers/notifications";

import { useTranslate } from "@tolgee/react";
import { useEffect } from "react";

const Notifications = () => {
	const { t } = useTranslate();
	const { notifications, sidebarVisibile } = useNotification();

	useEffect(() => {
		// Each time the sidebar come visible, scroll to the bottom of notification-scrollable
		if (sidebarVisibile) {
			const scrollable = document.getElementById("notification-scrollable");

			setTimeout(() => {
				if (scrollable) {
					scrollable.scrollTop = scrollable.scrollHeight;
				}
			}, 300);
		}
	}, [sidebarVisibile]);

	return (
		<div className="flex flex-col flex-1 p-4 space-y-4 overflow-hidden">
			<div className="flex flex-col flex-1 space-y-2 overflow-hidden">
				<h2 className="flex items-center justify-center gap-2 text-sm font-bold">
					<svg
						width="11"
						height="14"
						viewBox="0 0 11 14"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
						className="opacity-60"
					>
						<path
							d="M10.9609 9.67188C10.9609 9.85417 10.9245 10.026 10.8516 10.1875C10.7839 10.349 10.6875 10.4896 10.5625 10.6094C10.4427 10.7292 10.3021 10.8255 10.1406 10.8984C9.97917 10.9661 9.8099 11 9.63281 11H8.16406V11.0547C8.16406 11.4141 8.09115 11.7526 7.94531 12.0703C7.80469 12.388 7.61198 12.6641 7.36719 12.8984C7.1224 13.1328 6.83854 13.3203 6.51562 13.4609C6.19271 13.5964 5.85417 13.6641 5.5 13.6641C5.15625 13.6641 4.82292 13.5964 4.5 13.4609C4.17708 13.3255 3.89323 13.1406 3.64844 12.9062C3.40365 12.6719 3.20573 12.3984 3.05469 12.0859C2.90885 11.7734 2.83594 11.4401 2.83594 11.0859V11H1.36719C1.1849 11 1.01042 10.9661 0.84375 10.8984C0.682292 10.8255 0.541667 10.7292 0.421875 10.6094C0.302083 10.4896 0.205729 10.349 0.132812 10.1875C0.0651042 10.0208 0.03125 9.84635 0.03125 9.66406C0.03125 9.40885 0.0989583 9.17448 0.234375 8.96094L1.5 6.94531V4.25781C1.5 3.71615 1.60677 3.20833 1.82031 2.73438C2.03906 2.25521 2.33073 1.83854 2.69531 1.48438C3.0651 1.13021 3.48958 0.851562 3.96875 0.648438C4.45312 0.440104 4.96354 0.335938 5.5 0.335938C6.05208 0.335938 6.57031 0.440104 7.05469 0.648438C7.54427 0.856771 7.96875 1.14323 8.32812 1.50781C8.69271 1.86719 8.97917 2.29167 9.1875 2.78125C9.39583 3.26562 9.5 3.78385 9.5 4.33594V6.94531L10.7578 8.96094C10.8932 9.17448 10.9609 9.41146 10.9609 9.67188ZM1.36719 9.66406H9.63281L8.26562 7.48438C8.19792 7.38021 8.16406 7.26302 8.16406 7.13281V4.28125C8.16406 3.92188 8.09115 3.58333 7.94531 3.26562C7.80469 2.94792 7.61198 2.67188 7.36719 2.4375C7.1224 2.19792 6.83854 2.01042 6.51562 1.875C6.19271 1.73438 5.85417 1.66406 5.5 1.66406C5.13021 1.66406 4.78385 1.73438 4.46094 1.875C4.13802 2.01562 3.85417 2.20833 3.60938 2.45312C3.36979 2.69271 3.17969 2.97396 3.03906 3.29688C2.90365 3.61979 2.83594 3.96615 2.83594 4.33594V7.13281C2.83594 7.26302 2.80208 7.38021 2.73438 7.48438L1.36719 9.66406ZM6.83594 11H4.16406C4.16406 11.1823 4.19792 11.3542 4.26562 11.5156C4.33854 11.6771 4.4349 11.8203 4.55469 11.9453C4.67969 12.0651 4.82292 12.1615 4.98438 12.2344C5.14583 12.3021 5.31771 12.3359 5.5 12.3359C5.68229 12.3359 5.85417 12.3021 6.01562 12.2344C6.17708 12.1615 6.31771 12.0651 6.4375 11.9453C6.5625 11.8203 6.65885 11.6771 6.72656 11.5156C6.79948 11.3542 6.83594 11.1823 6.83594 11Z"
							fill="black"
						/>
					</svg>

					<span>{t("notifications", "Notifications")}</span>
				</h2>

				<ul
					className="flex-1 space-y-2 overflow-auto"
					id="notification-scrollable"
				>
					{notifications.map((notification, index) => {
						const hasVideo =
							notification?.visualHint?.video !== undefined;

						let videoId = "";

						if (hasVideo) {
							// Get the youtube watch id
							videoId = notification?.visualHint?.video.split("v=")[1];
						}

						return (
							<li
								key={`notification-side-${index}`}
								className="relative"
							>
								<div className="p-4 bg-white rounded">
									<p
										className="mt-1 text-sm dark:text-white line-clamp-3"
										dangerouslySetInnerHTML={{
											__html: notification.message.replaceAll(
												"\n",
												"<br />"
											),
										}}
									/>

									{hasVideo && (
										<figure className="relative mt-2 overflow-hidden rounded-md aspect-video">
											<button className="absolute inset-0 flex items-center justify-center w-full h-full transition bg-black bg-opacity-0 hover:bg-opacity-50">
												<svg
													width="64"
													height="46"
													viewBox="0 0 64 46"
													fill="none"
													xmlns="http://www.w3.org/2000/svg"
												>
													<g clipPath="url(#clip0_2142_2250)">
														<path
															d="M62.6625 7.52666C61.9261 4.76088 59.7584 2.58235 57.0039 1.84323C52.0132 0.5 31.9996 0.5 31.9996 0.5C31.9996 0.5 11.986 0.5 6.99528 1.84323C4.24164 2.58235 2.07305 4.76088 1.33751 7.52666C0 12.5402 0 23 0 23C0 23 0 33.459 1.33751 38.4733C2.07305 41.2391 4.24164 43.4168 6.99613 44.1568C11.9868 45.5 32.0004 45.5 32.0004 45.5C32.0004 45.5 52.014 45.5 57.0047 44.1568C59.7584 43.4168 61.9269 41.2391 62.6633 38.4733C64.0008 33.4598 64.0008 23 64.0008 23C64.0008 23 64.0008 12.5402 62.6633 7.52666"
															fill="#FF0000"
														/>
														<path
															d="M25.4531 32.4963L42.1804 23L25.4531 13.5029V32.4963Z"
															fill="white"
														/>
													</g>
													<defs>
														<clipPath id="clip0_2142_2250">
															<rect
																width="64"
																height="45"
																fill="white"
																transform="translate(0 0.5)"
															/>
														</clipPath>
													</defs>
												</svg>
											</button>

											<img
												src={`https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`}
												alt=""
												className="object-cover w-full h-full"
											/>
										</figure>
									)}

									{notification.visualHint?.image && (
										<figure className="relative mt-2 overflow-hidden rounded-md aspect-video">
											<button className="absolute inset-0 flex items-center justify-center w-full h-full transition bg-black bg-opacity-50 opacity-0 hover:opacity-50"></button>

											<img
												src={notification.visualHint.image}
												alt=""
												className="object-cover w-full h-full"
											/>
										</figure>
									)}

									{notification.action && (
										<Button
											size="sm"
											onClick={() => notification.action.onClick()}
											className="mt-2"
										>
											{notification.action.label}
										</Button>
									)}
								</div>

								{/* If this is the last item */}
								{index === notifications.length - 1 && (
									<svg
										className="w-full h-auto -mt-1"
										viewBox="0 0 352 115"
										fill="none"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											d="M0 0H352V26C352 28.2091 350.209 30 348 30H4C1.79086 30 0 28.2091 0 26V0Z"
											fill="#FBFEFF"
										/>
										<path
											d="M230.543 8.43196C233.655 5.32035 231.451 0 227.051 0H161.939C159.211 0 157 2.21141 157 4.93932V70.0508C157 74.4512 162.32 76.655 165.432 73.5434L230.543 8.43196Z"
											fill="#FBFEFF"
										/>
										<path
											d="M205 30.003H157V39L205 30.003Z"
											fill="#E3EBF1"
											fill-opacity="0.9"
										/>
										<g clipPath="url(#clip0_184_6862)">
											<path
												d="M252.085 99.9332C251.841 99.9332 251.588 99.8912 251.336 99.7988C250.215 99.3873 249.634 98.1443 250.047 97.0273C251.546 92.9457 252.835 89.5611 252.835 89.5611C253.256 88.4441 254.511 87.8898 255.631 88.3097C256.751 88.7297 257.316 89.981 256.886 91.098C256.886 91.098 255.606 94.4658 254.115 98.5223C253.795 99.3957 252.961 99.9416 252.085 99.9416V99.9332Z"
												fill="#15365E"
											/>
											<path
												d="M248.342 94.9865C247.963 94.9865 247.584 94.8857 247.239 94.6842C246.212 94.0795 245.875 92.7525 246.481 91.7279C249.218 87.1255 251.391 86.1177 251.998 85.9246L253.362 90.023C253.362 90.023 253.413 90.0146 253.506 89.9726C253.489 89.9726 252.166 90.6613 250.212 93.9367C249.808 94.617 249.084 94.9949 248.351 94.9949L248.342 94.9865Z"
												fill="#15365E"
											/>
											<path
												d="M258.865 100.051C257.829 100.051 256.911 99.3033 256.734 98.2535C256.001 93.9703 255.437 90.3925 255.437 90.3925C255.251 89.2168 256.06 88.1082 257.239 87.9234C258.418 87.7386 259.53 88.5449 259.715 89.7207C259.715 89.7207 260.28 93.2732 261.004 97.5312C261.206 98.707 260.406 99.824 259.227 100.017C259.1 100.034 258.983 100.051 258.865 100.051Z"
												fill="#15365E"
											/>
											<path
												d="M263.894 96.2211C263.195 96.2211 262.513 95.8851 262.1 95.2721C259.657 91.6691 257.661 88.6457 257.661 88.6457C257.004 87.6463 257.282 86.3109 258.276 85.6558C259.278 85.0007 260.617 85.2779 261.274 86.2689C261.274 86.2689 263.262 89.2756 265.688 92.8533C266.353 93.8443 266.092 95.1881 265.107 95.8516C264.736 96.1035 264.315 96.2211 263.894 96.2211Z"
												fill="#15365E"
											/>
											<path
												d="M256.499 94.0039C259.825 94.0039 262.521 91.3154 262.521 87.999C262.521 84.6826 259.825 81.9941 256.499 81.9941C253.173 81.9941 250.477 84.6826 250.477 87.999C250.477 91.3154 253.173 94.0039 256.499 94.0039Z"
												fill="#234F7A"
											/>
											<path
												d="M256.499 94.0039C259.825 94.0039 262.521 91.3154 262.521 87.999C262.521 84.6826 259.825 81.9941 256.499 81.9941C253.173 81.9941 250.477 84.6826 250.477 87.999C250.477 91.3154 253.173 94.0039 256.499 94.0039Z"
												fill="#0264B5"
											/>
											<path
												d="M256.389 64.9033C259.385 64.9033 261.813 62.4817 261.813 59.4947C261.813 56.5076 259.385 54.0861 256.389 54.0861C253.393 54.0861 250.965 56.5076 250.965 59.4947C250.965 62.4817 253.393 64.9033 256.389 64.9033Z"
												fill="#15365E"
											/>
											<path
												d="M264.463 60.9649L264.767 80.3041C264.797 82.2188 263.264 83.7967 261.344 83.8268L252.19 83.9702C250.269 84.0002 248.687 82.4711 248.657 80.5565L248.352 61.2173C248.338 60.3355 249.043 59.6105 249.927 59.5967L262.829 59.3946C263.713 59.3807 264.44 60.0833 264.454 60.965L264.463 60.9649Z"
												fill="#D7EBFF"
											/>
											<path
												opacity="0.15"
												d="M282.836 115C295.642 115 306.024 112.575 306.024 109.583C306.024 106.591 295.642 104.166 282.836 104.166C270.03 104.166 259.648 106.591 259.648 109.583C259.648 112.575 270.03 115 282.836 115Z"
												fill="black"
											/>
											<path
												d="M314.663 98.9674C313.787 98.9674 312.962 98.4383 312.633 97.5732C311.1 93.5336 309.787 90.1826 309.787 90.1826C309.349 89.074 309.904 87.8226 311.016 87.3859C312.128 86.9492 313.383 87.5035 313.821 88.6121C313.821 88.6121 315.143 91.9799 316.685 96.0531C317.106 97.1701 316.542 98.4131 315.421 98.833C315.169 98.9254 314.908 98.9758 314.655 98.9758L314.663 98.9674Z"
												fill="#15365E"
											/>
											<path
												d="M318.352 93.9787C317.62 93.9787 316.904 93.6092 316.499 92.9373C314.52 89.6787 313.181 89.0152 313.164 89.0068C313.257 89.0488 313.307 89.0572 313.307 89.0572L314.63 84.942C315.236 85.1351 317.418 86.1177 320.205 90.6949C320.829 91.7111 320.5 93.0465 319.481 93.6595C319.127 93.8695 318.74 93.9703 318.361 93.9703L318.352 93.9787Z"
												fill="#15365E"
											/>
											<path
												d="M307.891 99.1521C307.781 99.1521 307.663 99.1437 307.545 99.1269C306.366 98.9422 305.558 97.8336 305.751 96.6578C306.434 92.3914 306.964 88.8388 306.964 88.8304C307.141 87.6462 308.244 86.84 309.424 87.008C310.611 87.1843 311.428 88.2845 311.251 89.4603C311.251 89.4603 310.721 93.0381 310.03 97.3381C309.862 98.4047 308.944 99.1605 307.891 99.1605V99.1521Z"
												fill="#15365E"
											/>
											<path
												d="M302.83 95.3728C302.417 95.3728 302.004 95.2552 301.634 95.0117C300.631 94.3566 300.362 93.0128 301.019 92.0218C303.402 88.4189 305.356 85.3954 305.365 85.3954C306.013 84.396 307.353 84.1021 308.355 84.7488C309.357 85.3954 309.652 86.7308 309.003 87.7302C309.003 87.7302 307.041 90.7704 304.632 94.3986C304.219 95.0285 303.529 95.3644 302.821 95.3644L302.83 95.3728Z"
												fill="#15365E"
											/>
											<path
												d="M310.159 93.08C313.485 93.08 316.181 90.3916 316.181 87.0751C316.181 83.7587 313.485 81.0703 310.159 81.0703C306.833 81.0703 304.137 83.7587 304.137 87.0751C304.137 90.3916 306.833 93.08 310.159 93.08Z"
												fill="#234F7A"
											/>
											<path
												d="M310.159 93.08C313.485 93.08 316.181 90.3916 316.181 87.0751C316.181 83.7587 313.485 81.0703 310.159 81.0703C306.833 81.0703 304.137 83.7587 304.137 87.0751C304.137 90.3916 306.833 93.08 310.159 93.08Z"
												fill="#0264B5"
											/>
											<path
												d="M273.855 97.758C275.758 97.758 277.3 96.2201 277.3 94.323C277.3 92.4259 275.758 90.8881 273.855 90.8881C271.952 90.8881 270.41 92.4259 270.41 94.323C270.41 96.2201 271.952 97.758 273.855 97.758Z"
												fill="#15365E"
											/>
											<path
												d="M265.52 108.693H275.854C276.848 108.693 277.657 107.886 277.657 106.895V97.6824C277.657 97.0693 277.345 96.4982 276.823 96.179L270.582 92.257C270.152 91.9882 269.579 92.215 269.461 92.7105L265.528 108.693H265.52Z"
												fill="#D7EBFF"
											/>
											<path
												d="M267.127 101.966L268.997 108.693H263.648C262.89 108.693 262.469 107.819 262.941 107.231L267.135 101.974L267.127 101.966Z"
												fill="#FF5B00"
											/>
											<path
												d="M293.179 97.758C295.082 97.758 296.624 96.2201 296.624 94.323C296.624 92.4259 295.082 90.8881 293.179 90.8881C291.277 90.8881 289.734 92.4259 289.734 94.323C289.734 96.2201 291.277 97.758 293.179 97.758Z"
												fill="#15365E"
											/>
											<path
												d="M301.481 108.693H291.146C290.152 108.693 289.344 107.886 289.344 106.895V97.6824C289.344 97.0693 289.655 96.4982 290.178 96.179L296.419 92.257C296.848 91.9882 297.421 92.215 297.539 92.7105L301.472 108.693H301.481Z"
												fill="#D7EBFF"
											/>
											<path
												d="M299.831 101.966L297.961 108.693H303.309C304.067 108.693 304.489 107.819 304.017 107.231L299.822 101.974L299.831 101.966Z"
												fill="#FF5B00"
											/>
											<path
												d="M290.229 88.2341H276.762C271.7 88.2341 267.589 84.1357 267.589 79.0882V59.0915C267.589 57.0171 269.274 55.3374 271.354 55.3374H295.645C297.726 55.3374 299.41 57.0171 299.41 59.0915V79.0882C299.41 84.1357 295.3 88.2341 290.238 88.2341H290.229Z"
												fill="#D7EBFF"
											/>
											<path
												d="M299.411 67.8259H267.59V69.4888H299.411V67.8259Z"
												fill="#15365E"
											/>
											<path
												d="M275.751 73.0245C278.17 73.0245 280.131 71.0693 280.131 68.6574C280.131 66.2454 278.17 64.2902 275.751 64.2902C273.332 64.2902 271.371 66.2454 271.371 68.6574C271.371 71.0693 273.332 73.0245 275.751 73.0245Z"
												fill="#D7EBFF"
											/>
											<path
												d="M275.753 73.8644C272.872 73.8644 270.539 71.5296 270.539 68.6657C270.539 65.8019 272.881 63.4671 275.753 63.4671C278.625 63.4671 280.966 65.8019 280.966 68.6657C280.966 71.5296 278.625 73.8644 275.753 73.8644ZM275.753 65.13C273.799 65.13 272.207 66.7173 272.207 68.6657C272.207 70.6142 273.799 72.2015 275.753 72.2015C277.707 72.2015 279.299 70.6142 279.299 68.6657C279.299 66.7173 277.707 65.13 275.753 65.13Z"
												fill="#15365E"
											/>
											<path
												d="M309.98 65.424C312.864 65.424 315.202 63.0927 315.202 60.2169C315.202 57.3412 312.864 55.0099 309.98 55.0099C307.096 55.0099 304.758 57.3412 304.758 60.2169C304.758 63.0927 307.096 65.424 309.98 65.424Z"
												fill="#15365E"
											/>
											<path
												d="M317.717 61.8L317.606 80.4274C317.595 82.2666 316.087 83.7527 314.242 83.7418L305.424 83.6896C303.579 83.6787 302.089 82.1749 302.1 80.3357L302.211 61.7082C302.216 60.86 302.911 60.1754 303.761 60.1804L316.193 60.254C317.044 60.259 317.73 60.9518 317.725 61.8L317.717 61.8Z"
												fill="#D7EBFF"
											/>
											<path
												d="M246.93 35.1139L254.089 38.003L254.771 11.3547L247.477 13.8742C246.264 14.2942 245.431 15.4196 245.397 16.7045L245.001 32.1829C244.967 33.4678 245.734 34.6352 246.93 35.1139Z"
												fill="#FF5B00"
											/>
											<path
												d="M319.524 36.97L312.23 39.4895L312.913 12.8412L320.072 15.7303C321.268 16.209 322.034 17.3848 322.001 18.6614L321.605 34.1397C321.571 35.4247 320.746 36.5501 319.524 36.97Z"
												fill="#FF5B00"
											/>
											<path
												d="M250.937 13.3955L250.365 35.769C250.314 37.6251 250.634 39.4307 251.316 41.1524C251.973 42.8069 252.925 44.3018 254.155 45.5952C255.384 46.8886 256.833 47.9132 258.459 48.6522C260.143 49.4165 261.937 49.828 263.799 49.87L301.937 50.8442C303.798 50.8946 305.609 50.5755 307.335 49.8952C308.995 49.2401 310.494 48.2911 311.791 47.0649C313.088 45.8388 314.116 44.3942 314.857 42.7733C315.623 41.0936 316.036 39.3048 316.078 37.4487L316.651 15.0752C316.701 13.2192 316.381 11.4135 315.699 9.69181C315.051 8.03732 314.09 6.54239 312.861 5.24903C311.631 3.95567 310.182 2.93106 308.557 2.19199C306.872 1.42774 305.078 1.01621 303.217 0.974219L265.079 -1.20979e-06C263.218 -0.0503919 261.407 0.268749 259.68 0.949024C258.021 1.5957 256.522 2.55313 255.224 3.7793C253.927 5.00548 252.9 6.45001 252.159 8.07091C251.392 9.7506 250.979 11.5395 250.937 13.3955Z"
												fill="#D7EBFF"
											/>
											<path
												d="M253.263 34.1665L253.839 11.792C253.946 7.65288 257.4 4.38079 261.551 4.487L299.685 5.46278C303.836 5.56899 307.117 9.01345 307.011 13.1525L306.435 35.527C306.328 39.6661 302.874 42.9382 298.723 42.832L260.589 41.8562C256.438 41.75 253.157 38.3055 253.263 34.1665Z"
												fill="#15365E"
											/>
											<path
												d="M282.162 9.65821C283.181 8.25566 287.687 8.33125 288.285 10.2881C288.875 12.2449 288.42 25.0778 287.073 26.6651C285.725 28.2524 281.851 28.0592 281.261 26.4551C280.671 24.851 280.823 11.4975 282.171 9.65821H282.162Z"
												fill="white"
											/>
											<path
												d="M273.73 9.43147C272.736 7.97854 268.011 7.82737 267.278 9.75061C266.545 11.6739 266.309 24.5151 267.632 26.1696C268.929 27.7905 273.022 27.8241 273.738 26.2536C274.454 24.6831 275.027 11.3379 273.73 9.43147Z"
												fill="white"
											/>
											<path
												d="M277.613 34.3665C287.552 34.6184 288.596 31.5278 291.637 31.553C293.203 31.5614 292.226 39.1536 277.504 38.7757C263.151 38.4061 261.938 31.7546 263.825 31.5026C265.358 31.301 267.169 34.1061 277.613 34.3665Z"
												fill="white"
											/>
										</g>
										<defs>
											<clipPath id="clip0_184_6862">
												<rect
													width="77"
													height="115"
													fill="white"
													transform="translate(245)"
												/>
											</clipPath>
										</defs>
									</svg>
								)}
							</li>
						);
					})}
				</ul>
			</div>
		</div>
	);
};

export default Notifications;
